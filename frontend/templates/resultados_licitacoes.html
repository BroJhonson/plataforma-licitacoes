<h4>Resultados da Busca ({{ licitacoes_data.total_registros | default(0) }} encontradas)</h4>
<p>Página {{ licitacoes_data.pagina_atual }} de {{ licitacoes_data.total_paginas }}. Exibindo {{ licitacoes_data.licitacoes | length }} por página.</p>
<p><small>Origem dos dados: {{ licitacoes_data.origem_dados }}</small></p>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Número PNCP</th>
            <th>Objeto da Compra</th>
            <th>Modalidade</th>
            <th>Município/UF</th>
            <th>Valor Estimado</th>
            <th>Publicação PNCP</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for lic in licitacoes_data.licitacoes %}
        <tr>
            <td>{{ lic.numeroControlePNCP }}</td>
            <td>{{ lic.objetoCompra | truncate(100, True) }}</td> <!-- truncate para não ficar muito longo -->
            <td>{{ lic.modalidadeNome }}</td>
            <td>{{ lic.unidadeOrgaoMunicipioNome }}/{{ lic.unidadeOrgaoUfSigla }}</td>
            <td>R$ {{ "%.2f"|format(lic.valorTotalEstimado | float) if lic.valorTotalEstimado else 'N/I' }}</td>
            <td>{{ lic.dataPublicacaoPncp }}</td>
            <td>
                <a href="{{ url_for('detalhes_licitacao', pncp_id=lic.numeroControlePNCP) }}" class="btn btn-sm btn-info">Detalhes</a>
                {% if lic.link_portal_pncp %}
                <a href="{{ lic.link_portal_pncp }}" class="btn btn-sm btn-outline-secondary" target="_blank">Ver no PNCP</a>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="text-center">Nenhuma licitação encontrada com os filtros atuais.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Paginação Simples -->
{% if licitacoes_data.total_paginas > 1 %}
<nav aria-label="Navegação das licitações">
    <ul class="pagination justify-content-center">
        <!-- Botão Anterior -->
        <li class="page-item {% if licitacoes_data.pagina_atual == 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('buscar_licitacoes', pagina=licitacoes_data.pagina_atual - 1, porPagina=licitacoes_data.por_pagina, **filtros_atuais) }}">Anterior</a>
        </li>

        <!-- Números das Páginas (exemplo simples, pode ser melhorado para mostrar "...") -->
        {% set numeros_paginas_mostrar = 5 %}
        {% set inicio_loop = [1, licitacoes_data.pagina_atual - (numeros_paginas_mostrar // 2)] | max %}
        {% set fim_loop = [licitacoes_data.total_paginas, inicio_loop + numeros_paginas_mostrar - 1] | min %}
        
        {% if inicio_loop > 1 %}
            <li class="page-item"><a class="page-link" href="{{ url_for('buscar_licitacoes', pagina=1, porPagina=licitacoes_data.por_pagina, **filtros_atuais) }}">1</a></li>
            {% if inicio_loop > 2 %} <li class="page-item disabled"><span class="page-link">...</span></li> {% endif %}
        {% endif %}

        {% for i in range(inicio_loop, fim_loop + 1) %}
        <li class="page-item {% if i == licitacoes_data.pagina_atual %}active{% endif %}">
            <a class="page-link" href="{{ url_for('buscar_licitacoes', pagina=i, porPagina=licitacoes_data.por_pagina, **filtros_atuais) }}">{{ i }}</a>
        </li>
        {% endfor %}

        {% if fim_loop < licitacoes_data.total_paginas %}
            {% if fim_loop < licitacoes_data.total_paginas - 1 %} <li class="page-item disabled"><span class="page-link">...</span></li> {% endif %}
            <li class="page-item"><a class="page-link" href="{{ url_for('buscar_licitacoes', pagina=licitacoes_data.total_paginas, porPagina=licitacoes_data.por_pagina, **filtros_atuais) }}">{{ licitacoes_data.total_paginas }}</a></li>
        {% endif %}

        <!-- Botão Próximo -->
        <li class="page-item {% if licitacoes_data.pagina_atual == licitacoes_data.total_paginas %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('buscar_licitacoes', pagina=licitacoes_data.pagina_atual + 1, porPagina=licitacoes_data.por_pagina, **filtros_atuais) }}">Próxima</a>
        </li>
    </ul>
</nav>
{% endif %}